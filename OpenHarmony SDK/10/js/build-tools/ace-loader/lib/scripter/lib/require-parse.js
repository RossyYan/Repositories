var path=require("path"),fs=require("fs");const crypto=require("crypto");var existsSync=fs.existsSync||path.existsSync,nodePaths=process.env.NODE_PATH?process.env.NODE_PATH.split(":"):[],cwd=process.cwd();function resolvePath(e,r){return"."===e[0]?findModuleMain(path.resolve(r,e)):findModuleMain(path.resolve(r,"node_modules",e))||""}function resolveRequire(e,r){var s=resolvePath(e,path.dirname(r));if(!s&&"."!==e[0]&&"/"!==e[0])for(var n=0;n<nodePaths.length&&!(s=findModuleMain(path.resolve(nodePaths[n],e)));n++);return s}function findModuleMain(e){var r="";function s(e){r||existsSync(e)&&(r=e)}s((e=".js"===path.extname(e)?e.replace(/\..+/,""):e)+".js");try{var n=JSON.parse(fs.readFileSync(e+"/package.json").toString());s(path.resolve(e,n.main+".js")),s(path.resolve(e,n.main))}catch(e){}return s(e+"/index.js"),r}nodePaths.push(cwd);var REQUIRE_REGEXP=/require\s*\(['"]([\w\/\.-]*)['"]\)/g;function parseAndReplaceRequire(e,a){a=a||".";var t={},o=[];return{code:e=e.replace(REQUIRE_REGEXP,function(e,r){var s,n=resolveRequire(path.resolve(cwd,a,r),".");return(n=n||resolveRequire(r,"."))?((s=crypto.createHash("sha256")).update(n.toString()),s=s.digest("hex"),t[s]=n,'browserifyRequire("'+s+'")'):(o.push({reason:'ERROR: Cannot find required module "'+r+'"'}),e)}),requires:t,log:o}}exports.parseAndReplaceRequire=parseAndReplaceRequire;