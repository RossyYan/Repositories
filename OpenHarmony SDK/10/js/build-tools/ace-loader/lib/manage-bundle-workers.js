"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof"),path=_interopRequireWildcard(require("path")),_cluster=_interopRequireDefault(require("cluster")),_process=_interopRequireDefault(require("process"));function _getRequireWildcardCache(e){var r,t;return"function"!=typeof WeakMap?null:(r=new WeakMap,t=new WeakMap,(_getRequireWildcardCache=function(e){return e?t:r})(e))}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};r=_getRequireWildcardCache(r);if(r&&r.has(e))return r.get(e);var t,a,i={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&((a=u?Object.getOwnPropertyDescriptor(e,t):null)&&(a.get||a.set)?Object.defineProperty(i,t,a):i[t]=e[t]);return i.default=e,r&&r.set(e,i),i}var genAbcScript="gen-abc.js",FAIL=1,arkEnvParams=(void 0===_process.default.env.arkEnvParams&&_process.default.exit(FAIL),JSON.parse(_process.default.env.arkEnvParams));if(void 0!==arkEnvParams.workerNumber&&void 0!==arkEnvParams.splittedData&&void 0!==arkEnvParams.cmdPrefix){var clusterNewApiVersion=16,currentNodeVersion=parseInt(_process.default.version.split(".")[0]),useNewApi=clusterNewApiVersion<=currentNodeVersion,workerNumber=parseInt(arkEnvParams.workerNumber),splittedData=JSON.parse(arkEnvParams.splittedData),cmdPrefix=arkEnvParams.cmdPrefix;if(useNewApi&&_cluster.default.isPrimary||!useNewApi&&_cluster.default.isMaster){useNewApi?_cluster.default.setupPrimary({exec:path.resolve(__dirname,genAbcScript)}):_cluster.default.setupMaster({exec:path.resolve(__dirname,genAbcScript)});for(var i=0;i<workerNumber;++i){var workerData={inputs:JSON.stringify(splittedData[i]),cmd:cmdPrefix};_cluster.default.fork(workerData)}_cluster.default.on("exit",function(e,r,t){r===FAIL&&_process.default.exit(FAIL)})}}