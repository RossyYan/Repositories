"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormattingElementList=exports.EntryType=void 0;const NOAH_ARK_CAPACITY=3;var EntryType;!function(e){e[e.Marker=0]="Marker",e[e.Element=1]="Element"}(EntryType=exports.EntryType||(exports.EntryType={}));const MARKER={type:EntryType.Marker};class FormattingElementList{constructor(e){this.treeAdapter=e,this.entries=[],this.bookmark=null}_getNoahArkConditionCandidates(e,t){var r=[],n=t.length,i=this.treeAdapter.getTagName(e),s=this.treeAdapter.getNamespaceURI(e);for(let e=0;e<this.entries.length;e++){var a=this.entries[e];if(a.type===EntryType.Marker)break;var a=a["element"];this.treeAdapter.getTagName(a)===i&&this.treeAdapter.getNamespaceURI(a)===s&&(a=this.treeAdapter.getAttrList(a)).length===n&&r.push({idx:e,attrs:a})}return r}_ensureNoahArkCondition(e){if(!(this.entries.length<NOAH_ARK_CAPACITY)){var r=this.treeAdapter.getAttrList(e),n=this._getNoahArkConditionCandidates(e,r);if(!(n.length<NOAH_ARK_CAPACITY)){const s=new Map(r.map(e=>[e.name,e.value]));let t=0;for(let e=0;e<n.length;e++){var i=n[e];i.attrs.every(e=>s.get(e.name)===e.value)&&(t+=1)>=NOAH_ARK_CAPACITY&&this.entries.splice(i.idx,1)}}}}insertMarker(){this.entries.unshift(MARKER)}pushElement(e,t){this._ensureNoahArkCondition(e),this.entries.unshift({type:EntryType.Element,element:e,token:t})}insertElementAfterBookmark(e,t){var r=this.entries.indexOf(this.bookmark);this.entries.splice(r,0,{type:EntryType.Element,element:e,token:t})}removeEntry(e){e=this.entries.indexOf(e);0<=e&&this.entries.splice(e,1)}clearToLastMarker(){var e=this.entries.indexOf(MARKER);0<=e?this.entries.splice(0,e+1):this.entries.length=0}getElementEntryInScopeWithTagName(t){var e=this.entries.find(e=>e.type===EntryType.Marker||this.treeAdapter.getTagName(e.element)===t);return e&&e.type===EntryType.Element?e:null}getElementEntry(t){return this.entries.find(e=>e.type===EntryType.Element&&e.element===t)}}exports.FormattingElementList=FormattingElementList;