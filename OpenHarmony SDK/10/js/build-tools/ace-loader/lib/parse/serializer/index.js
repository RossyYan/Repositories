"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.serializeOuter=exports.serialize=void 0;const html_js_1=require("../common/html.js"),escape_js_1=require("entities/lib/escape.js"),default_js_1=require("../tree-adapters/default.js"),VOID_ELEMENTS=new Set([html_js_1.TAG_NAMES.AREA,html_js_1.TAG_NAMES.BASE,html_js_1.TAG_NAMES.BASEFONT,html_js_1.TAG_NAMES.BGSOUND,html_js_1.TAG_NAMES.BR,html_js_1.TAG_NAMES.COL,html_js_1.TAG_NAMES.EMBED,html_js_1.TAG_NAMES.FRAME,html_js_1.TAG_NAMES.HR,html_js_1.TAG_NAMES.IMG,html_js_1.TAG_NAMES.INPUT,html_js_1.TAG_NAMES.KEYGEN,html_js_1.TAG_NAMES.LINK,html_js_1.TAG_NAMES.META,html_js_1.TAG_NAMES.PARAM,html_js_1.TAG_NAMES.SOURCE,html_js_1.TAG_NAMES.TRACK,html_js_1.TAG_NAMES.WBR]);function isVoidElement(e,t){return t.treeAdapter.isElementNode(e)&&t.treeAdapter.getNamespaceURI(e)===html_js_1.NS.HTML&&VOID_ELEMENTS.has(t.treeAdapter.getTagName(e))}const defaultOpts={treeAdapter:default_js_1.defaultTreeAdapter,scriptingEnabled:!0};function serialize(e,t){t=Object.assign(Object.assign({},defaultOpts),t);return isVoidElement(e,t)?"":serializeChildNodes(e,t)}function serializeOuter(e,t){return serializeNode(e,Object.assign(Object.assign({},defaultOpts),t))}function serializeChildNodes(e,t){let s="";e=t.treeAdapter.isElementNode(e)&&t.treeAdapter.getTagName(e)===html_js_1.TAG_NAMES.TEMPLATE&&t.treeAdapter.getNamespaceURI(e)===html_js_1.NS.HTML?t.treeAdapter.getTemplateContent(e):e,e=t.treeAdapter.getChildNodes(e);if(e)for(const r of e)s+=serializeNode(r,t);return s}function serializeNode(e,t){return t.treeAdapter.isElementNode(e)?serializeElement(e,t):t.treeAdapter.isTextNode(e)?serializeTextNode(e,t):t.treeAdapter.isCommentNode(e)?serializeCommentNode(e,t):t.treeAdapter.isDocumentTypeNode(e)?serializeDocumentTypeNode(e,t):""}function serializeElement(e,t){var s=t.treeAdapter.getTagName(e);return`<${s}${serializeAttributes(e,t)}>`+(isVoidElement(e,t)?"":serializeChildNodes(e,t)+`</${s}>`)}function serializeAttributes(e,{treeAdapter:t}){let s="";for(const r of t.getAttrList(e)){if(s+=" ",r.namespace)switch(r.namespace){case html_js_1.NS.XML:s+="xml:"+r.name;break;case html_js_1.NS.XMLNS:"xmlns"!==r.name&&(s+="xmlns:"),s+=r.name;break;case html_js_1.NS.XLINK:s+="xlink:"+r.name;break;default:s+=r.prefix+":"+r.name}else s+=r.name;s+=`="${(0,escape_js_1.escapeAttribute)(r.value)}"`}return s}function serializeTextNode(e,t){var s=t["treeAdapter"],r=s.getTextNodeContent(e),e=s.getParentNode(e),a=e&&s.isElementNode(e)&&s.getTagName(e);return a&&s.getNamespaceURI(e)===html_js_1.NS.HTML&&(0,html_js_1.hasUnescapedText)(a,t.scriptingEnabled)?r:(0,escape_js_1.escapeText)(r)}function serializeCommentNode(e,{treeAdapter:t}){return`<!--${t.getCommentNodeContent(e)}-->`}function serializeDocumentTypeNode(e,{treeAdapter:t}){return`<!DOCTYPE ${t.getDocumentTypeNodeName(e)}>`}exports.serialize=serialize,exports.serializeOuter=serializeOuter;