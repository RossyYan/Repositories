"use strict";var _util=require("./util"),_parser=require("./parser"),compiler=require("./lite/lite-transform-template"),_require=require("./lite/lite-enum"),DEVICE_LEVEL=_require.DEVICE_LEVEL;module.exports=function(e){var r,t=this,l=(process.env.DEVICE_LEVEL!==DEVICE_LEVEL.RICH&&0<e.lastIndexOf("</element>")&&(r=e.lastIndexOf("</element>"),e=e.substr(r+10,e.length)),this.cacheable&&this.cacheable(),this.async()),i=!1;(0,_parser.parseTemplate)(e,this.resourcePath).then(function(e){var r=e.parsed,e=e.log;e&&e.length&&(i=(0,_util.logWarn)(t,e)),process.env.DEVICE_LEVEL===DEVICE_LEVEL.LITE&&(r=i?"function () { return {} }":compiler.transformTemplate(r)),l(null,r)}).catch(function(e){(0,_util.logWarn)(t,[{reason:"ERROR: Failed to parse the HML file. "+e}]),l("")})};