"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof"),parse5=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseFragment=parseFragment,exports.parseScript=parseScript,exports.parseStyle=parseStyle,exports.parseTemplate=parseTemplate,_interopRequireWildcard(require("parse5"))),_templater=_interopRequireDefault(require("./templater")),_styler=_interopRequireDefault(require("./styler")),_scripter=_interopRequireDefault(require("./scripter")),_component_validator=require("./templater/component_validator"),_util=require("./util");function _getRequireWildcardCache(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(_getRequireWildcardCache=function(e){return e?r:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,n,a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((n=i?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(a,r,n):a[r]=e[r]);return a.default=e,t&&t.set(e,a),a}function getAttribute(e,t){if(e.attrs)for(var r,n=e.attrs.length;n--;)if((r=e.attrs[n]).name===t)return r.value}function extractDependencies(e,t){e.childNodes&&e.childNodes.forEach(function(e){(0,_component_validator.checkTagName)(e,{result:{},deps:t,log:[]}),extractDependencies(e,t)})}function parseFragment(e){var e=parse5.parseFragment(e,{locationInfo:!0}),i={deps:[],element:[],template:[],style:[],script:[],data:[],config:[]};return e.childNodes.forEach(function(e){var t,r,n,a;"script"===e.tagName?"data"!==(t=getAttribute(e,"type"))&&"config"!==t&&(t="script"):t=e.tagName,"we-element"===t&&(console.warn('<we-element name="'.concat(getAttribute(e,"name"),'"> is deprecated, please use <element> instead.')),t="element"),i[t]&&(a=getAttribute(e,"name"),r=getAttribute(e,"src"),n=getAttribute(e,"lang"),i[t].push({name:a,src:r,lang:n,node:e}),"template"===t)&&(extractDependencies(e.content,a=[]),i.deps=a)}),i}function parseTemplate(e,t){return new Promise(function(r,n){_templater.default.parse(e,function(e,t){e?n(e):(e=(e=JSON.stringify(t.jsonTemplate,_util.stringifyFunction,"  ")).replace(_util.FUNC_START_REG,"").replace(_util.FUNC_END_REG,""),r({parsed:e,log:t.log}))},t)})}function parseStyle(e,t){return new Promise(function(r,n){_styler.default.parse(e,function(e,t){e?n(e):(e=JSON.stringify(t.jsonStyle,null,2),r({parsed:e,log:t.log}))},t)})}function parseScript(r){return new Promise(function(e,t){e({parsed:_scripter.default.fix(r)})})}