"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_path=require("path"),fs=require("fs"),_require=require("./lite-enum"),REGEXP_PNG=_require.REGEXP_PNG,iconPath=process.env.iconPath||"",img2bin=require("./lite-image2bin"),ImageCoverterPlugin=function(){function t(e){(0,_classCallCheck2.default)(this,t),this.options=e}return(0,_createClass2.default)(t,[{key:"getDir",value:function(e){var e=_path.resolve("",e),n=[];return function i(r){fs.readdirSync(r).forEach(function(e){var e=_path.join(r,e),t=fs.statSync(e);t.isFile()?REGEXP_PNG.test(e)&&n.push(e):t.isDirectory()&&i(e)})}(e),n}},{key:"apply",value:function(e){var n=this.options.build,a=this.getDir;e.hooks.done.tap("image coverter",function(e,t){function i(e){fs.writeFile(_path.resolve(n,"image_convert_result.txt"),e,function(e){if(e)return console.error(e)})}var r=a(n);0<r.length?(r=r.map(function(e){return img2bin(e)}),Promise.all(r).then(function(){i("{exitCode:0}")}).catch(function(){i("{exitCode:1}")})):i("{exitCode:0}"),""!==iconPath&&a(iconPath).forEach(function(e){img2bin(e)})})}}]),t}();module.exports=ImageCoverterPlugin;