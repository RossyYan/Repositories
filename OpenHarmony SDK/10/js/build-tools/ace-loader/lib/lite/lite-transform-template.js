"use strict";var _optionRules,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));function _createForOfIteratorHelper(r,e){var t,n,a,o,c="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(c)return n=!(t=!0),{s:function(){c=c.call(r)},n:function(){var r=c.next();return t=r.done,r},e:function(r){n=!0,a=r},f:function(){try{t||null==c.return||c.return()}finally{if(n)throw a}}};if(Array.isArray(r)||(c=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length)return c&&(r=c),o=0,{s:e=function(){},n:function(){return o>=r.length?{done:!0}:{done:!1,value:r[o++]}},e:function(r){throw r},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){var t;if(r)return"string"==typeof r?_arrayLikeToArray(r,e):"Map"===(t="Object"===(t=Object.prototype.toString.call(r).slice(8,-1))&&r.constructor?r.constructor.name:t)||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var _require=require("./lite-utils"),isFunction=_require.isFunction,isObject=_require.isObject,isUndefined=_require.isUndefined,_require2=require("./lite-enum"),SPECIAL_STYLE=_require2.SPECIAL_STYLE,REGEXP_NUMBER_PX=_require2.REGEXP_NUMBER_PX,REGEXP_COLOR=_require2.REGEXP_COLOR,REGEXP_UNIT=_require2.REGEXP_UNIT,REGXP_QUOTES=_require2.REGXP_QUOTES,REGXP_LANGUAGE=_require2.REGXP_LANGUAGE,REGXP_LANGUAGE_KEY=_require2.REGXP_LANGUAGE_KEY,REGXP_FUNC_RETURN=_require2.REGXP_FUNC_RETURN,parameterArray=[],parameter1="",parameter2="",i18nMapping={},ATTRBUTES="attrs",EVENTS_ON_FUNC="on",KEY="key",AST_KEY={ATTR:"attr",CLASSLIST:"classList",STYLE:"style",EVENTS:"events",TYPE:"type",CHILDREN:"children",KEY:"key"},EVENT_KEY=["onBubbleEvents","catchBubbleEvents","onCaptureEvents","catchCaptureEvents"],optionRules=((0,_defineProperty2.default)(_optionRules={},AST_KEY.ATTR,function(r,e,t){return 0!==Object.keys(e.attr).length&&(r+="'".concat(ATTRBUTES,"' : ").concat(transformProps(e.attr),",")),r}),(0,_defineProperty2.default)(_optionRules,AST_KEY.CLASSLIST,function(r,e,t){return r+=sortClass(e[t])}),(0,_defineProperty2.default)(_optionRules,AST_KEY.STYLE,function(r,e,t){return r+=sortStyle(e[t])}),(0,_defineProperty2.default)(_optionRules,AST_KEY.EVENTS,function(r,e,t){return r+="'".concat(EVENTS_ON_FUNC,"' : ").concat(transformEvents(e.events),",")}),(0,_defineProperty2.default)(_optionRules,AST_KEY.KEY,function(r,e,t){return r+="'".concat(KEY,"' : ").concat(e.key,",")}),_optionRules),styleRules=[{match:function(r,e){return r===SPECIAL_STYLE.ANIMATION_DELAY||r===SPECIAL_STYLE.ANIMATION_DURATION},action:function(r,e,t){return r+="'".concat(e,"' : ").concat(JSON.stringify(t),",")}},{match:function(r,e){return r===SPECIAL_STYLE.ANIMATION_ITERATION_COUNT},action:function(r,e,t){return-1===t&&(t="infinite"),r+="'".concat(e,"' : ").concat(JSON.stringify(t),",")}},{match:function(r,e){return r===SPECIAL_STYLE.BACKGROUND_IMAGE},action:function(r,e,t){return r+="'".concat(e,"' : ").concat(checkType(t.replace(REGXP_QUOTES,"")),",")}},{match:function(r,e){return!0},action:function(r,e,t){return r+="'".concat(e,"' : ").concat(checkType(t),",")}}];function transformTemplate(r){var r=Function("return ".concat(r))(),r=(r=isObject(r)?transformNode(r):"_c('div')").replace(/,$/,""),e=Object.values(i18nMapping),e=0===e.length?"":" var i18ns = []; ".concat(e.join(";"),";"),e="function (vm) { var _vm = vm || this;".concat(e," return ").concat(r," }");return i18nMapping={},e}function transformNode(r){return(r.repeat&&!r.forCompiled?transformFor:r.shown&&!r.ifCompiled?transformIf:transformNodeDetail)(r)}function transformNodeDetail(r){var e=r.type,t=transformOptions(r),r=transformChildren(r);return"_c('".concat(e,"'").concat(t?", ".concat(t," "):"").concat(r?", ".concat(r," "):"","),")}function transformOptions(r){var e="";parameter2=parameterArray[parameterArray.length-1],r.attr&&r.attr.tid&&""!==parameter2&&(r.key="".concat(parameter2,".").concat(r.attr.tid),delete r.attr.tid);for(var t=0,n=Object.keys(r);t<n.length;t++){var a=n[t];a!==AST_KEY.TYPE&&a!==AST_KEY.CHILDREN&&optionRules[a]&&(e=optionRules[a](e,r,a))}return""===e?null:"{"+e.replace(/,$/,"")+"}"}function sortClass(r){var e="",t=checkType(r);return!isFunction(r)&&!isUndefined(r)||REGXP_LANGUAGE.test(r)?e+="'".concat("staticClass","' : ").concat(t,","):e+="'".concat("dynamicClass","' : ").concat(formatForFunc(t),","),e}function sortStyle(r){for(var e="",t="",n=0,a=Object.keys(r);n<a.length;n++){var o=a[n],c=r[o];if(isFunction(c)&&!REGXP_LANGUAGE.test(c))t+="'".concat(o,"' : ").concat(formatForFunc(c),",");else for(var i=0;i<styleRules.length;i++)if(styleRules[i].match(o,c)){e=styleRules[i].action(e,o,c);break}}return(e=""!==e?"'".concat("staticStyle","' : {").concat(e.replace(/,$/,""),"}, "):e)+(t=""!==t?"'".concat("dynamicStyle","' :{").concat(t.replace(/,$/,""),"},"):t)}function checkType(r){return isFunction(r)||isUndefined(r)?formatForFunc(r):isObject(r)?transformProps(r):isNaN(Number(r))?REGEXP_NUMBER_PX.test(r)?parseInt(r.replace(REGEXP_UNIT,""),10):REGEXP_COLOR.test(r)?parseInt(r.slice(1),16):"true"===r||"false"!==r&&JSON.stringify(r):Number(r)}function transformProps(r){for(var e="",t=0,n=Object.keys(r);t<n.length;t++){var a=n[t],o=r[a];"value"===a?isFunction(o)||isUndefined(o)?e+="'".concat(a,"' : ").concat(formatForFunc(r[a]),","):e+="'".concat(a,"' : ").concat(JSON.stringify(r[a]),","):e+="'".concat(a,"' : ").concat(checkType(r[a]),",")}return e="{".concat(e.replace(/,$/,""),"}")}function transformEvents(r){for(var e="",t=0,n=Object.keys(r);t<n.length;t++){var a=n[t];isFunction(r[a])?e+="'".concat(a,"' : ").concat(formatForFunc(r[a]),","):e+="'".concat(a,"' : ").concat(formatForString(r[a]),",")}return e="{".concat(e.replace(/,$/,""),"}")}function formatForString(r){for(var e=!1,t=0,n=parameterArray;t<n.length;t++){var a=n[t],o="$"===a.charAt(0)?"\\":"";if(new RegExp(o+a).test(r)){e=!0;break}}return e?r:"_vm."+r}function transformFor(r){var e=r.repeat.exp||r.repeat,r=(parameterArray.push(r.repeat.key||"$idx"),parameterArray.push(r.repeat.value||"$item"),r.forCompiled=!0,e=formatForFunc(e),transformNode(r).replace(/,$/,"")),t=(parameter2=parameterArray[parameterArray.length-1],""!==(parameter1=parameterArray[parameterArray.length-2])&&""!==parameter2?",":"");return parameterArray.pop(),parameterArray.pop(),"_l(("+e+"),function("+parameter2+t+parameter1+"){return "+r+"}),"}function transformIf(r){r.ifCompiled=!0;var e=transformNode(r).replace(/,$/,"");return"_i(("+formatForFunc(r.shown)+"),function(){return "+e+"}),"}function formatForFunc(r){var e,t=r.toString(),n=_createForOfIteratorHelper(parameterArray);try{for(n.s();!(e=n.n()).done;)var a=e.value,o="$"===a.charAt(0)?"\\":"",c=new RegExp("this."+o+a+"\\b","g"),t=t.replace(c,a)}catch(r){n.e(r)}finally{n.f()}return t=cacheI18nTranslation(t=t.replace(/this\./g,"_vm."))}function handleLangSingle(r,e){var t;return e.includes(r)?(e=Object.values(i18nMapping),t=i18nMapping[r],"i18ns[".concat(e.lastIndexOf(t),"]")):(i18nMapping[r]="i18ns.push( ".concat(r," )"),"i18ns[".concat(Object.keys(i18nMapping).length-1,"]"))}function handleLangMulti(r,e,t,n){var a=n;if(e.includes(t))var n=Object.values(i18nMapping),o=i18nMapping[t],a="i18ns[".concat(n.lastIndexOf(o),"]");else for(var c=0;c<r.length;c++){var i,u,s=r[c];a=e.includes(s)?(i=Object.values(i18nMapping),u=i18nMapping[s],a.replace(s,"i18ns[".concat(i.lastIndexOf(u),"]"))):(i18nMapping[s]="i18ns.push( ".concat(s," )"),a.replace(s,"i18ns[".concat(Object.keys(i18nMapping).length-1,"]"))),c!==r.length-1||a.includes("_vm.")||(i=REGXP_FUNC_RETURN.exec(a),REGXP_FUNC_RETURN.lastIndex=0,u=i[1].trim(),i18nMapping[t]="i18ns.push( ".concat(u," )"),a="i18ns[".concat(Object.keys(i18nMapping).length-1,"]"))}return a}function cacheI18nTranslation(r){var e,t,n;return REGXP_LANGUAGE.test(r)&&(e=r.match(REGXP_LANGUAGE_KEY),t=Object.keys(i18nMapping),n=REGXP_FUNC_RETURN.exec(r),REGXP_FUNC_RETURN.lastIndex=0,isUseForInstrucParam(n=n[1].trim())||(r=1===e.length&&e[0]===n?handleLangSingle(e[0],t):handleLangMulti(e,t,n,r))),r}function isUseForInstrucParam(r){var e,t=!1,n=_createForOfIteratorHelper(parameterArray);try{for(n.s();!(e=n.n()).done;){var a=e.value,o="$"===a.charAt(0)?"\\":"";if(new RegExp(o+a).test(r)){t=!0;break}}}catch(r){n.e(r)}finally{n.f()}return t}function transformChildren(r){var e=r.children;if(!e)return null;for(var t="",n=0;n<e.length;n++)t+=transformNode(e[n]);return t="["+t.replace(/,$/,"")+"]"}EVENT_KEY.map(function(n){optionRules[n]=function(r,e,t){return r+="'".concat(n,"' : ").concat(transformEvents(e[n]),",")}}),exports.transformTemplate=transformTemplate;