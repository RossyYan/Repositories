"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_excluded=["condition"];function ownKeys(r,e){var t,n=Object.keys(r);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(r),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),n.push.apply(n,t)),n}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){(0,_defineProperty2.default)(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _createForOfIteratorHelper(e,r){var t,n,o,a,i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return n=!(t=!0),{s:function(){i=i.call(e)},n:function(){var e=i.next();return t=e.done,e},e:function(e){n=!0,o=e},f:function(){try{t||null==i.return||i.return()}finally{if(n)throw o}}};if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length)return i&&(e=i),a=0,{s:r=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){var t;if(e)return"string"==typeof e?_arrayLikeToArray(e,r):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _require=require("./lite-enum"),SPECIAL_STYLE=_require.SPECIAL_STYLE,REGEXP_NUMBER_PX=_require.REGEXP_NUMBER_PX,REGEXP_COLOR=_require.REGEXP_COLOR,REGEXP_UNIT=_require.REGEXP_UNIT,REGXP_QUOTES=_require.REGXP_QUOTES;function transformStyle(e){for(var r=Function("return ".concat(e))(),t={},n={},o={},e=Object.keys(r),a=0,i=e;a<i.length;a++){var c=i[a];"."===c.charAt(0)?n[c.slice(1)]=styleFormat(r[c]):"#"===c.charAt(0)?t[c.slice(1)]=styleFormat(r[c]):"@KEYFRAMES"===c?o["@keyframes"]=keyFrameFormat(r[c]):"@MEDIA"===c&&(o["@media"]=mediaQueryFormat(r[c]))}return null!=r&&0!==e.length&&(0!==Object.keys(t).length&&(o.idSelectors=t),0!==Object.keys(n).length)&&(o.classSelectors=n),JSON.stringify(o)}function keyFrameFormat(e){for(var r=0,t=Object.keys(e);r<t.length;r++){var n,o=_createForOfIteratorHelper(e[t[r]]);try{for(o.s();!(n=o.n()).done;)for(var a=n.value,i=0,c=Object.keys(a);i<c.length;i++){var u=c[i],l=a[u];REGEXP_COLOR.test(l)&&(a[u]=parseInt(l.slice(1),16));try{a[u]=JSON.parse(a[u])}catch(e){}}}catch(e){o.e(e)}finally{o.f()}}return e}function mediaQueryFormat(e){var r,t=[],n=_createForOfIteratorHelper(e);try{for(n.s();!(r=n.n()).done;){var o=r.value,a=o.condition,i=(0,_objectWithoutProperties2.default)(o,_excluded),c=transformStyle(JSON.stringify(i));c&&(c=JSON.parse(c),t.push(_objectSpread({condition:a},c)))}}catch(e){n.e(e)}finally{n.f()}return t}var rules=[{match:function(e,r){return e===SPECIAL_STYLE.ANIMATION_DELAY||e===SPECIAL_STYLE.ANIMATION_DURATION},action:function(e,r,t){e[r]=t}},{match:function(e,r){return e===SPECIAL_STYLE.ANIMATION_ITERATION_COUNT},action:function(e,r,t){e[r]=(t=-1===t?"infinite":t).toString()}},{match:function(e,r){return[SPECIAL_STYLE.BACKGROUND_IMAGE,SPECIAL_STYLE.BACKGROUND_IMAGE_ACTIVE,SPECIAL_STYLE.BACKGROUND_IMAGE_CHECKED].includes(e)},action:function(e,r,t){e[r]=t.replace(REGXP_QUOTES,"")}},{match:function(e,r){return!isNaN(Number(r))},action:function(e,r,t){e[r]=Number(t)}},{match:function(e,r){return REGEXP_NUMBER_PX.test(r)},action:function(e,r,t){e[r]=parseInt(t.replace(REGEXP_UNIT,""),10)}},{match:function(e,r){return REGEXP_COLOR.test(r)},action:function(e,r,t){e[r]=parseInt(t.slice(1),16)}},{match:function(e,r){return"true"===r},action:function(e,r,t){e[r]=!0}},{match:function(e,r){return"false"===r},action:function(e,r,t){e[r]=!1}}];function styleFormat(e){for(var r=0,t=Object.keys(e);r<t.length;r++)for(var n=t[r],o=e[n],a=0;a<rules.length;a++)if(rules[a].match(n,o)){rules[a].action(e,n,o);break}return e}exports.transformStyle=transformStyle;