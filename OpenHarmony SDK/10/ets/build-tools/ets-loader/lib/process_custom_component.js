"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.assignComponentParams=assignComponentParams,exports.createConditionParent=createConditionParent,exports.isRecycle=isRecycle,exports.processCustomComponent=processCustomComponent;var _typescript=_interopRequireDefault(require("typescript")),_pre_define=require("./pre_define"),_validate_ui_syntax=require("./validate_ui_syntax"),_process_component_member=require("./process_component_member"),_utils=require("./utils"),_process_component_build=require("./process_component_build"),_main=require("../main"),_component_map=require("./component_map"),_process_component_class=require("./process_component_class");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}let decoractorMap;function processCustomComponent(a,n,o,c,p=!1,s=!1,_=void 0){var f=this,l=(decoractorMap=new Map([[_pre_define.COMPONENT_STATE_DECORATOR,_validate_ui_syntax.stateCollection],[_pre_define.COMPONENT_LINK_DECORATOR,_validate_ui_syntax.linkCollection],[_pre_define.COMPONENT_PROP_DECORATOR,_validate_ui_syntax.propCollection],[_pre_define.COMPONENT_NON_DECORATOR,_validate_ui_syntax.regularCollection],[_pre_define.COMPONENT_PROVIDE_DECORATOR,_validate_ui_syntax.provideCollection],[_pre_define.COMPONENT_OBJECT_LINK_DECORATOR,_validate_ui_syntax.objectLinkCollection]]),getCustomComponentNode(a));if(l){var d=isRecycle(c),y=l.parent&&_typescript.default.isPropertyAccessExpression(l.parent);let r=!1,e=(0,_process_component_member.createCustomComponentNewExpression)(l,c,p,s),i;var u,C,E={reuseId:null};isHasChild(l)&&((i=l.arguments[0].properties.slice()).forEach(function(e,t){_newArrowCheck(this,f),isToChange(e,c)&&(r=!0,e=_typescript.default.factory.updatePropertyAssignment(e,e.name,changeNodeFromCallToArrow(e.initializer)),i.splice(t,1,e))}.bind(this)),r)&&(u=_typescript.default.factory.updateExpressionStatement(a,_typescript.default.factory.createNewExpression(l.expression,l.typeArguments,[_typescript.default.factory.createObjectLiteralExpression(i,!0)])),e=(0,_process_component_member.createCustomComponentNewExpression)(u.expression,c,p));let t;_main.partialUpdateConfig.partialUpdateMode&&_&&(t=n.length),y&&(_main.partialUpdateConfig.partialUpdateMode?(u=[_typescript.default.factory.createExpressionStatement((0,_process_component_build.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_COMMON),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),null))],C=[],(0,_process_component_build.bindComponentAttr)(a,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_COMMON),u,o,!0,!1,C,!1,E),n.push((0,_process_component_build.createComponentCreationStatement)(componentAttributes(_pre_define.COMPONENT_COMMON),u,_pre_define.COMPONENT_COMMON,s,!1,void 0,C))):(n.push(_typescript.default.factory.createExpressionStatement((0,_process_component_build.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_COMMON),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),null))),(0,_process_component_build.bindComponentAttr)(a,_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_COMMON),n,o))),d&&_main.partialUpdateConfig.partialUpdateMode&&n.push(createRecycleComponent(s)),addCustomComponent(a,n,e,o,c,l,p,s,d,E),y&&n.push(_typescript.default.factory.createExpressionStatement((0,_process_component_build.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_COMMON),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION),null))),d&&_main.partialUpdateConfig.partialUpdateMode&&n.push(componentAttributes(_pre_define.COMPONENT_RECYCLE)),_main.partialUpdateConfig.partialUpdateMode&&_&&n.splice(t,n.length-t,(0,_process_component_build.ifRetakeId)(n.slice(t),_))}}function isRecycle(e){return _utils.storedFileInfo.getCurrentArkTsFile().recycleComponents.has(e)}function createRecycleComponent(e){return(0,_process_component_build.createComponentCreationStatement)(componentAttributes(_pre_define.COMPONENT_RECYCLE),[_typescript.default.factory.createExpressionStatement((0,_process_component_build.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_RECYCLE),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),null))],_pre_define.COMPONENT_RECYCLE,e)}function componentAttributes(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(e),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_POP_FUNCTION)),void 0,[]))}function isHasChild(e){return e.arguments&&e.arguments[0]&&_typescript.default.isObjectLiteralExpression(e.arguments[0])&&e.arguments[0].properties&&0<e.arguments[0].properties.length}function isToChange(e,t){t=_validate_ui_syntax.builderParamObjectCollection.get(t);return!(!(e.initializer&&_typescript.default.isCallExpression(e.initializer)&&t&&t.has(e.name.getText()))||/\.(bind|call|apply)/.test(e.initializer.getText()))}function changeNodeFromCallToArrow(e){let t=_typescript.default.factory.createExpressionStatement(e);return _typescript.default.isCallExpression(e)&&e.expression&&_typescript.default.isIdentifier(e.expression)&&_component_map.GLOBAL_CUSTOM_BUILDER_METHOD.has(e.expression.escapedText.toString())&&(t=(0,_process_component_build.transferBuilderCall)(_typescript.default.factory.createExpressionStatement(e),e.expression.escapedText.toString())),_typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([t],!0))}function addCustomComponent(e,t,r,i,a,n,o,c,p,s){var _;_typescript.default.isNewExpression(r)&&(validateCustomComponentPrams(n,a,_=[],i,o),addCustomComponentStatements(e,t,r,a,_,n,o,c,p,s))}function addCustomComponentStatements(e,t,r,i,a,n,o,c,p,s){_main.partialUpdateConfig.partialUpdateMode?t.push(createCustomComponent(r,i,n,c,o,p,s)):(n=_utils.componentInfo.id.toString(),t.push(createFindChildById(n,i,o),createCustomComponentIfStatement(n,_typescript.default.factory.updateExpressionStatement(e,(0,_process_component_member.createViewCreate)(r)),_typescript.default.factory.createObjectLiteralExpression(a,!0),i)))}function createChildElmtId(e,t){var r=this;const i=[],a=[];return _validate_ui_syntax.propCollection.get(t)&&i.push(..._validate_ui_syntax.propCollection.get(t)),_validate_ui_syntax.objectLinkCollection.get(t)&&i.push(..._validate_ui_syntax.objectLinkCollection.get(t)),e.arguments[0].properties&&e.arguments[0].properties.forEach(function(e){_newArrowCheck(this,r),_typescript.default.isIdentifier(e.name)&&i.includes(e.name.escapedText.toString())&&a.push(e)}.bind(this)),a}function createCustomComponent(e,t,r,i,a,n,o){let c;c=r.arguments&&r.arguments.length?_typescript.default.factory.createObjectLiteralExpression(createChildElmtId(r,t),!0):_typescript.default.factory.createObjectLiteralExpression([],!1);var p=[_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.ELMTID)),_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.ISINITIALRENDER))],e=[createIfCustomComponent(e,r,c,t,i,a,n,o)],r=(n&&p.push(_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),void 0,void 0,_typescript.default.factory.createNull())),!n&&_main.partialUpdateConfig.optimizeComponent||(e.unshift((0,_process_component_build.createViewStackProcessorStatement)(_pre_define.STARTGETACCESSRECORDINGFOR,_pre_define.ELMTID)),e.push((0,_process_component_build.createViewStackProcessorStatement)(_pre_define.STOPGETACCESSRECORDING))),[_typescript.default.factory.createArrowFunction(void 0,void 0,p,void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock(e,!0))]);return n?o.reuseId?r.unshift(o.reuseId):r.unshift(_typescript.default.factory.createStringLiteral(t)):_main.partialUpdateConfig.optimizeComponent&&r.push(_typescript.default.factory.createNull()),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(i?_typescript.default.factory.createParenthesizedExpression((0,_process_component_build.parentConditionalExpression)()):_typescript.default.factory.createThis(),n?_typescript.default.factory.createIdentifier(_pre_define.OBSERVE_RECYCLE_COMPONENT_CREATION):_typescript.default.factory.createIdentifier(_main.partialUpdateConfig.optimizeComponent?_pre_define.OBSERVECOMPONENTCREATION2:_pre_define.OBSERVECOMPONENTCREATION)),void 0,r))],!0)}function assignRecycleParams(){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_FUNCTION)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_LAMBDA_FUNCTION)))],!0),void 0)}function assignComponentParams(e,t=!1){var[t,r]=splitComponentParams(e,t,!0);let i=!1;return!t.length&&e.arguments&&0<e.arguments.length&&e.arguments[0]&&(i=!0),_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_LAMBDA_FUNCTION),void 0,void 0,_typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([_typescript.default.factory.createReturnStatement(i?e.arguments[0]:_typescript.default.factory.createObjectLiteralExpression(reWriteComponentParams(t,r),!0))],!0)))],_typescript.default.NodeFlags.Let))}function reWriteComponentParams(e,r){var i=this;const a=[];return e.forEach(function(e,t){_newArrowCheck(this,i),r[t]?a.push(_typescript.default.factory.createPropertyAssignment(e,r[t])):a.push(_typescript.default.factory.createShorthandPropertyAssignment(e,void 0))}.bind(this)),a}function splitComponentParams(e,t,r){var i=this;const a=[],n=[];return e.arguments&&0<e.arguments.length&&_typescript.default.isObjectLiteralExpression(e.arguments[0])&&e.arguments[0].properties&&e.arguments[0].properties.forEach(function(e){_newArrowCheck(this,i);e=(0,_process_component_class.isProperty)(e)?(0,_process_component_class.createReference)(e,[],t,r):e;a.push(e.name),n.push(e.initializer)}.bind(this)),[a,n]}function createIfCustomComponent(e,t,r,i,a,n,o,c){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createIdentifier(_pre_define.ISINITIALRENDER),_typescript.default.factory.createBlock([assignComponentParams(t,n),o?assignRecycleParams():void 0,o?createNewRecycleComponent(e,t,i,c):createNewComponent(e)],!0),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(a?_typescript.default.factory.createParenthesizedExpression((0,_process_component_build.parentConditionalExpression)()):_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(_pre_define.UPDATE_STATE_VARS_OF_CHIND_BY_ELMTID)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.ELMTID),r]))],!0))}function createNewComponent(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME_PU),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION)),void 0,[e]))}function createNewRecycleComponent(e,t,r,i){var a=this;let n=[];const o=[];n=t.arguments&&0<t.arguments.length&&_typescript.default.isObjectLiteralExpression(t.arguments[0])&&t.arguments[0].properties?(t.arguments[0].properties.forEach(function(e){_newArrowCheck(this,a);e=(0,_process_component_class.createReference)(e,[],!1,!1,!0);o.push(e)}.bind(this)),[_typescript.default.factory.createObjectLiteralExpression(o,!1)]):[_typescript.default.factory.createObjectLiteralExpression([],!1)];t=_typescript.default.factory.createCallExpression(createRecyclePropertyNode(_pre_define.ABOUT_TO_REUSE),void 0,n);return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME_PU),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_RECYCLE)),void 0,[_typescript.default.factory.createConditionalExpression(_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.QuestionToken),_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ColonToken),e),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ExclamationEqualsEqualsToken),_typescript.default.factory.createNull()),i.reuseId||_typescript.default.factory.createStringLiteral(r),_typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([_typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createTypeOfExpression(createRecyclePropertyNode(_pre_define.COMPONENT_ABOUTTOREUSEINTERNAL_FUNCTION)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken),_typescript.default.factory.createStringLiteral(_pre_define.FUNCTION))),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(createRecyclePropertyNode(_pre_define.COMPONENT_ABOUTTOREUSEINTERNAL_FUNCTION),void 0,[]))],!0),_typescript.default.factory.createBlock([_typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(createRecyclePropertyNode(_pre_define.ABOUT_TO_REUSE),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createTypeOfExpression(createRecyclePropertyNode(_pre_define.ABOUT_TO_REUSE)),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken),_typescript.default.factory.createStringLiteral(_pre_define.FUNCTION))),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(t)],!0)),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(createRecyclePropertyNode(_pre_define.COMPONENT_RERENDER_FUNCTION),void 0,[]))],!0))],!0))]))}function createRecyclePropertyNode(e){return _typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.RECYCLE_NODE),_typescript.default.factory.createIdentifier(e))}function validateCustomComponentPrams(e,t,r,i,a){var n=this;const o=new Set([]);var c=e.arguments;getCollectionSet(t,_validate_ui_syntax.propertyCollection);const p=getCollectionSet(t,_validate_ui_syntax.linkCollection);c&&1===c.length&&_typescript.default.isObjectLiteralExpression(c[0])&&c[0].properties.forEach(function(e){_newArrowCheck(this,n),e.name&&_typescript.default.isIdentifier(e.name)&&o.add(e.name.escapedText.toString()),validateStateManagement(e,t,i,a),isNonThisProperty(e,p)&&(isToChange(e,t)&&(e=_typescript.default.factory.updatePropertyAssignment(e,e.name,changeNodeFromCallToArrow(e.initializer))),r.push(e))}.bind(this)),_utils.storedFileInfo.getCurrentArkTsFile().compFromDETS.has(t)||validateInitDecorator(e,t,o,i),validateMandatoryToInitViaParam(e,t,o,i)}function getCustomComponentNode(e){let t=e.expression,r=null,i=null;for(;t;){if(_typescript.default.isIdentifier(t)){r=t;break}t=t.expression}if(r){let e=r.parent;for(;e&&!_typescript.default.isExpressionStatement(e);){if(_typescript.default.isCallExpression(e)||_typescript.default.isEtsComponentExpression(e)){i=e;break}e=e.parent}}return i}function getCollectionSet(e,t){return t&&t.get(e)||new Set([])}function isThisProperty(e,t){return!!(_typescript.default.isPropertyAssignment(e)&&_typescript.default.isIdentifier(e.name)&&t.has(e.name.escapedText.toString()))}function isNonThisProperty(e,t){return!(_typescript.default.isPropertyAssignment(e)&&_typescript.default.isIdentifier(e.name)&&(e.initializer.escapedText&&e.initializer.escapedText.includes("$")||_typescript.default.isPropertyAccessExpression(e.initializer)&&e.initializer.expression&&e.initializer.expression.kind===_typescript.default.SyntaxKind.ThisKeyword&&_typescript.default.isIdentifier(e.initializer.name)&&e.initializer.name.escapedText.toString().includes("$"))||!_typescript.default.isPropertyAssignment(e)||!_typescript.default.isIdentifier(e.name)||t.has(e.name.escapedText.toString()))}function validateStateManagement(e,t,r,i){validateForbiddenToInitViaParam(e,t,r),checkFromParentToChild(e,t,r,i)}function checkFromParentToChild(t,r,i,e){let a;var n,r=getPropertyDecoratorKind(a=_typescript.default.isIdentifier(t.name)?t.name.escapedText.toString():a,r);let o;if(r)if(isInitFromParent(t)){o=getParentPropertyName(t,r,i);let e=_process_component_member.curPropMap.get(o);(e=e||_pre_define.COMPONENT_NON_DECORATOR)&&!isCorrectInitFormParent(e,r)&&validateIllegalInitFromParent(t,a,r,o,e,i)}else isInitFromLocal(t)&&_typescript.default.isPropertyAssignment(t)&&r!==_pre_define.COMPONENT_OBJECT_LINK_DECORATOR?isCorrectInitFormParent(_pre_define.COMPONENT_NON_DECORATOR,r)||validateIllegalInitFromParent(t,a,r,t.initializer.getText(),_pre_define.COMPONENT_NON_DECORATOR,i):r===_pre_define.COMPONENT_OBJECT_LINK_DECORATOR&&t.initializer&&(_typescript.default.isPropertyAccessExpression(t.initializer)||_typescript.default.isElementAccessExpression(t.initializer)||_typescript.default.isIdentifier(t.initializer))||(o=getParentPropertyName(t,r,i)||a,isCorrectInitFormParent(n=_pre_define.COMPONENT_NON_DECORATOR,r))||(e&&judgeStructAssigned$$(t)?i.push({type:_utils.LogType.WARN,message:`Unrecognized property '${o}', make sure it can be assigned to `+`${r} property '${a}' by yourself.`,pos:(t.initializer||t).getStart()}):validateIllegalInitFromParent(t,a,r,o,n,i,_utils.LogType.WARN))}function judgeStructAssigned$$(e){return _main.partialUpdateConfig.partialUpdateMode&&e.initializer&&_typescript.default.isPropertyAccessExpression(e.initializer)&&e.initializer.expression&&_typescript.default.isIdentifier(e.initializer.expression)&&e.initializer.expression.escapedText.toString()===_pre_define.$$}function isInitFromParent(e){if(_typescript.default.isPropertyAssignment(e)&&e.initializer)return!!(_typescript.default.isPropertyAccessExpression(e.initializer)&&e.initializer.expression&&e.initializer.expression.kind===_typescript.default.SyntaxKind.ThisKeyword&&_typescript.default.isIdentifier(e.initializer.name))||!(!_typescript.default.isIdentifier(e.initializer)||!matchStartWithDollar(e.initializer.getText()))||void 0}function isInitFromLocal(e){if(_typescript.default.isPropertyAssignment(e)&&_typescript.default.isIdentifier(e.initializer)&&!matchStartWithDollar(e.initializer.getText()))return!0}function getParentPropertyName(t,r,i){var a=t.initializer;if(a){let e=a.getText();return r===_pre_define.COMPONENT_LINK_DECORATOR?(r=a.name||a,e=hasDollar(a)?r.getText().replace(/^\$/,""):r.getText()):hasDollar(a)?validateNonLinkWithDollar(t,i):t.initializer&&t.initializer.name&&(e=t.initializer.name.getText()),e}}function isCorrectInitFormParent(e,t){switch(t){case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROP_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:return!0;case _pre_define.COMPONENT_NON_DECORATOR:if([_pre_define.COMPONENT_NON_DECORATOR,_pre_define.COMPONENT_STATE_DECORATOR,_pre_define.COMPONENT_LINK_DECORATOR,_pre_define.COMPONENT_PROP_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR,_pre_define.COMPONENT_STORAGE_LINK_DECORATOR].includes(e))return!0;break;case _pre_define.COMPONENT_LINK_DECORATOR:case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:return![_pre_define.COMPONENT_NON_DECORATOR].includes(e)}return!1}function getPropertyDecoratorKind(e,t){for(const r of decoractorMap.entries())if(getCollectionSet(t,r[1]).has(e))return r[0]}function createFindChildById(e,t,r=!1){return _typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(_typescript.default.factory.createIdentifier(""+_pre_define.CUSTOM_COMPONENT_EARLIER_CREATE_CHILD+e),void 0,_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(t)),_typescript.default.factory.createConditionalExpression(_typescript.default.factory.createParenthesizedExpression(_typescript.default.factory.createBinaryExpression(createConditionParent(r),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.AmpersandAmpersandToken),_typescript.default.factory.createPropertyAccessExpression(createConditionParent(r),_typescript.default.factory.createIdentifier(_pre_define.CUSTOM_COMPONENT_FUNCTION_FIND_CHILD_BY_ID)))),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.QuestionToken),_typescript.default.factory.createAsExpression(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createConditionParent(r),_typescript.default.factory.createIdentifier(""+_pre_define.CUSTOM_COMPONENT_FUNCTION_FIND_CHILD_BY_ID)),void 0,[r?_typescript.default.factory.createCallExpression(_typescript.default.factory.createIdentifier(_pre_define.GENERATE_ID),void 0,[]):_typescript.default.factory.createStringLiteral(e)]),_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(t))),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ColonToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_IF_UNDEFINED)))],_typescript.default.NodeFlags.Let))}function createConditionParent(e){return e?_typescript.default.factory.createParenthesizedExpression((0,_process_component_build.parentConditionalExpression)()):_typescript.default.factory.createThis()}function createCustomComponentIfStatement(e,t,r,i){e=""+_pre_define.CUSTOM_COMPONENT_EARLIER_CREATE_CHILD+e;return _typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createIdentifier(e),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsToken),_typescript.default.factory.createIdentifier(""+_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)),_typescript.default.factory.createBlock([t],!0),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(e),_typescript.default.factory.createIdentifier(""+_pre_define.COMPONENT_CONSTRUCTOR_UPDATE_PARAMS)),void 0,[r])),_validate_ui_syntax.isStaticViewCollection.get(i)?createStaticIf(e):void 0,_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(""+_pre_define.BASE_COMPONENT_NAME),_typescript.default.factory.createIdentifier(""+_pre_define.COMPONENT_CREATE_FUNCTION)),void 0,[_typescript.default.factory.createIdentifier(e)]))],!0))}function createStaticIf(e){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createPrefixUnaryExpression(_typescript.default.SyntaxKind.ExclamationToken,_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(e),_typescript.default.factory.createIdentifier(_pre_define.CUSTOM_COMPONENT_NEEDS_UPDATE_FUNCTION)),void 0,[])),_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(e),_typescript.default.factory.createIdentifier(_pre_define.CUSTOM_COMPONENT_MARK_STATIC_FUNCTION)),void 0,[]))],!0),void 0)}function hasDollar(e){return!(!_typescript.default.isPropertyAccessExpression(e)||!matchStartWithDollar(e.name.getText()))||!(!_typescript.default.isIdentifier(e)||!matchStartWithDollar(e.getText()))}function matchStartWithDollar(e){return/^\$/.test(e)}function validateForbiddenToInitViaParam(e,t,r){var i=new Set([...getCollectionSet(t,_validate_ui_syntax.storageLinkCollection),...getCollectionSet(t,_validate_ui_syntax.storagePropCollection),...getCollectionSet(t,_validate_ui_syntax.consumeCollection)]),a=new Set;(0,_validate_ui_syntax.getLocalStorageCollection)(t,a),(isThisProperty(e,i)||isThisProperty(e,a))&&r.push({type:_utils.LogType.ERROR,message:`Property '${e.name.getText()}' in the custom component '${t}'`+" cannot initialize here (forbidden to specify).",pos:e.name.getStart()})}function validateNonExistentProperty(e,t,r){r.push({type:_utils.LogType.ERROR,message:`Property '${e.name.escapedText.toString()}' does not exist on type '${t}'.`,pos:e.name.getStart()})}function validateMandatoryToAssignmentViaParam(t,e,r,i){var a=this;_validate_ui_syntax.builderParamObjectCollection.get(e)&&_validate_ui_syntax.builderParamObjectCollection.get(e).size&&_validate_ui_syntax.builderParamObjectCollection.get(e).forEach(function(e){_newArrowCheck(this,a),r.has(e)||i.push({type:_utils.LogType.ERROR,message:`The property decorated with @BuilderParam '${e}' must be assigned a value .`,pos:t.getStart()})}.bind(this))}function validateMandatoryToInitViaParam(t,r,i,a){var n=this;new Set([...getCollectionSet(r,_validate_ui_syntax.linkCollection),...getCollectionSet(r,_validate_ui_syntax.objectLinkCollection)]).forEach(function(e){_newArrowCheck(this,n),e&&!i.has(e)&&a.push({type:_utils.LogType.WARN,message:`Property '${e}' in the custom component '${r}'`+" is missing (mandatory to specify).",pos:t.getStart()})}.bind(this))}function validateInitDecorator(t,r,i,a){var n=this,e=new Set([...getCollectionSet(r,_validate_ui_syntax.builderParamObjectCollection),...getCollectionSet(r,_validate_ui_syntax.propCollection)]);const o=new Set([..._validate_ui_syntax.builderParamInitialization.get(r)||[],..._validate_ui_syntax.propInitialization.get(r)||[]]);e.forEach(function(e){_newArrowCheck(this,n),e&&!i.has(e)&&o&&!o.has(e)&&a.push({type:_utils.LogType.ERROR,message:`Property '${e}' in the custom component '${r}'`+" is missing assignment or initialization.",pos:t.getStart()})}.bind(this))}function validateIllegalInitFromParent(e,t,r,i,a,n,o=void 0){let c=_utils.LogType.ERROR;o?c=o:[_pre_define.COMPONENT_STATE_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR].includes(a)&&r===_pre_define.COMPONENT_OBJECT_LINK_DECORATOR&&(c=_utils.LogType.WARN),n.push({type:c,message:`The ${a} property '${i}' cannot be assigned to `+`the ${r} property '${t}'.`,pos:(e.initializer||e).getStart()})}function validateLinkWithoutDollar(e,t){t.push({type:_utils.LogType.ERROR,message:`The @Link property '${e.name.getText()}' should initialize`+" using '$' to create a reference to a @State or @Link variable.",pos:e.initializer.getStart()})}function validateNonLinkWithDollar(e,t){t.push({type:_utils.LogType.ERROR,message:`Property '${e.name.getText()}' cannot initialize`+" using '$' to create a reference to a variable.",pos:e.initializer.getStart()})}