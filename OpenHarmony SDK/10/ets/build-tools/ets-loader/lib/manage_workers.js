"use strict";var path=_interopRequireWildcard(require("path")),_cluster=_interopRequireDefault(require("cluster")),_process=_interopRequireDefault(require("process")),_pre_define=require("./pre_define"),_this=void 0;function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){var r,t;return"function"!=typeof WeakMap?null:(r=new WeakMap,t=new WeakMap,(_getRequireWildcardCache=function(e){return e?t:r})(e))}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};r=_getRequireWildcardCache(r);if(r&&r.has(e))return r.get(e);var t,a,i={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&((a=n?Object.getOwnPropertyDescriptor(e,t):null)&&(a.get||a.set)?Object.defineProperty(i,t,a):i[t]=e[t]);return i.default=e,r&&r.set(e,i),i}function _newArrowCheck(e,r){if(e!==r)throw new TypeError("Cannot instantiate an arrow function")}void 0===_process.default.env.arkEnvParams&&_process.default.exit(_pre_define.FAIL);let arkEnvParams=JSON.parse(_process.default.env.arkEnvParams);if(arkEnvParams.mode!==_pre_define.JSBUNDLE&&arkEnvParams.mode!==_pre_define.ESMODULE&&_process.default.exit(_pre_define.FAIL),void 0!==arkEnvParams.workerNumber&&void 0!==arkEnvParams.splittedData&&void 0!==arkEnvParams.cmdPrefix){let i=parseInt(arkEnvParams.workerNumber),n=JSON.parse(arkEnvParams.splittedData),u=arkEnvParams.cmdPrefix;const r=16,s=parseInt(_process.default.version.split(".")[0]),t=s>=r;if(t&&_cluster.default.isPrimary||!t&&_cluster.default.isMaster){let e=_pre_define.GEN_ABC_SCRIPT;arkEnvParams.mode===_pre_define.ESMODULE&&(e=_pre_define.GEN_MODULE_ABC_SCRIPT),t?_cluster.default.setupPrimary({exec:path.resolve(__dirname,e)}):_cluster.default.setupMaster({exec:path.resolve(__dirname,e)});for(let a=0;a<i;++a){let t={inputs:JSON.stringify(n[a]),cmd:u};if(arkEnvParams.mode===_pre_define.ESMODULE){let e=a+1,r=`filesInfo_${e}.txt`;t.workerFileName=r,t.cachePath=arkEnvParams.cachePath}_cluster.default.fork(t)}_cluster.default.on("exit",function(e,r,t){_newArrowCheck(this,_this),r===_pre_define.FAIL&&_process.default.exit(_pre_define.FAIL)}.bind(void 0))}}