"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SRC_MAIN=void 0,exports.writeFileSyncByNode=writeFileSyncByNode;var _path=_interopRequireDefault(require("path")),_typescript=_interopRequireDefault(require("typescript")),_fs=_interopRequireDefault(require("fs")),_transform=require("./fast_build/ark_compiler/transform"),_pre_define=require("./pre_define"),_utils=require("./utils"),_ark_utils=require("./ark_utils"),_validate_ui_syntax=require("./validate_ui_syntax"),_utils2=require("./fast_build/ark_compiler/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const SRC_MAIN="src/main";async function writeFileSyncByNode(t,r,i){var a=genContentAndSourceMapInfo(t,r);let o=(0,_utils.genTemporaryPath)(t.fileName,r.projectPath,process.env.cachePath,r);if(0!==o.length){o.endsWith(_pre_define.EXTNAME_ETS)&&(o=o.replace(/\.ets$/,_pre_define.EXTNAME_TS)),(0,_ark_utils.genSourceMapFileName)(o),(0,_utils.mkdirsSync)(_path.default.dirname(o));t=(0,_utils.toUnixPath)(t.fileName).replace((0,_utils.toUnixPath)(r.projectRootPath)+"/","");let e;e=("rollup"===process.env.compileTool?(_transform.newSourceMaps[t]=a.sourceMapJson,_transform):(_ark_utils.newSourceMaps[t]=a.sourceMapJson,_ark_utils)).newSourceMaps,r.compileHar||!(0,_utils2.isDebug)(r)&&(0,_utils2.isAotMode)(r)?await(0,_ark_utils.writeObfuscatedSourceCode)(a.content,o,i,r,t,e):_fs.default.writeFileSync(o,a.content)}}function genContentAndSourceMapInfo(e,t){var r=_typescript.default.createPrinter({newLine:_typescript.default.NewLineKind.LineFeed}),i=_typescript.default.createCompilerHost({sourceMap:!0}),a=e.fileName,i=_typescript.default.createSourceMapGenerator(i,_typescript.default.getBaseFileName(a),"","",{sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,sourceRoot:"",mapRoot:"",extendedDiagnostics:!1}),o=_typescript.default.createTextWriter(_typescript.default.getNewLineCharacter({newLine:_typescript.default.NewLineKind.LineFeed,removeComments:!1})),r=(r.writeFile(e,o,i),i.toJSON());r.sources=[(0,_utils.toUnixPath)(a).replace((0,_utils.toUnixPath)(t.projectRootPath)+"/","")];let s=o.getText();return{content:s="rollup"!==process.env.compileTool?(0,_ark_utils.transformModuleSpecifier)(a,(0,_validate_ui_syntax.processSystemApi)(s,!0),t):s,sourceMapJson:r}}exports.SRC_MAIN=SRC_MAIN;