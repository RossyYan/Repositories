"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.appStorageDecorators=exports.UpdateResult=void 0,exports.createCustomComponentNewExpression=createCustomComponentNewExpression,exports.createViewCreate=createViewCreate,exports.immutableDecorators=exports.forbiddenSpecifyDefaultValueDecorators=exports.decoratorParamSet=exports.curPropMap=void 0,exports.isSimpleType=isSimpleType,exports.observedPropertyDecorators=exports.mandatoryToInitViaParamDecorators=exports.mandatorySpecifyDefaultValueDecorators=void 0,exports.processMemberVariableDecorators=processMemberVariableDecorators,exports.stateObjectCollection=exports.simpleTypes=exports.setUpdateParamsDecorators=exports.setStateVarsDecorators=exports.propAndLinkDecorators=void 0;var _typescript=_interopRequireDefault(require("typescript")),_pre_define=require("./pre_define"),_component_map=require("./component_map"),_validate_ui_syntax=require("./validate_ui_syntax"),_process_component_constructor=require("./process_component_constructor"),_utils=require("./utils"),_process_component_class=require("./process_component_class"),_process_ui_syntax=require("./process_ui_syntax"),_main=require("../main"),_process_component_build=require("./process_component_build");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function _defineProperty(e,t,r){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}const path=require("path"),observedPropertyDecorators=new Set([_pre_define.COMPONENT_STATE_DECORATOR,_pre_define.COMPONENT_PROVIDE_DECORATOR]),propAndLinkDecorators=(exports.observedPropertyDecorators=observedPropertyDecorators,new Set([_pre_define.COMPONENT_PROP_DECORATOR,_pre_define.COMPONENT_LINK_DECORATOR])),appStorageDecorators=(exports.propAndLinkDecorators=propAndLinkDecorators,new Set([_pre_define.COMPONENT_STORAGE_PROP_DECORATOR,_pre_define.COMPONENT_STORAGE_LINK_DECORATOR,_pre_define.COMPONENT_LOCAL_STORAGE_LINK_DECORATOR,_pre_define.COMPONENT_LOCAL_STORAGE_PROP_DECORATOR])),mandatorySpecifyDefaultValueDecorators=(exports.appStorageDecorators=appStorageDecorators,new Set([...observedPropertyDecorators,...appStorageDecorators])),forbiddenSpecifyDefaultValueDecorators=(exports.mandatorySpecifyDefaultValueDecorators=mandatorySpecifyDefaultValueDecorators,new Set([_pre_define.COMPONENT_LINK_DECORATOR,_pre_define.COMPONENT_CONSUME_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR])),mandatoryToInitViaParamDecorators=(exports.forbiddenSpecifyDefaultValueDecorators=forbiddenSpecifyDefaultValueDecorators,new Set([...propAndLinkDecorators,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR])),setUpdateParamsDecorators=(exports.mandatoryToInitViaParamDecorators=mandatoryToInitViaParamDecorators,new Set([...observedPropertyDecorators,_pre_define.COMPONENT_PROP_DECORATOR,_pre_define.COMPONENT_OBJECT_LINK_DECORATOR,_pre_define.COMPONENT_BUILDERPARAM_DECORATOR])),setStateVarsDecorators=(exports.setUpdateParamsDecorators=setUpdateParamsDecorators,new Set([_pre_define.COMPONENT_OBJECT_LINK_DECORATOR])),immutableDecorators=(exports.setStateVarsDecorators=setStateVarsDecorators,new Set([_pre_define.COMPONENT_OBJECT_LINK_DECORATOR,_pre_define.COMPONENT_BUILDERPARAM_DECORATOR])),simpleTypes=(exports.immutableDecorators=immutableDecorators,new Set([_typescript.default.SyntaxKind.StringKeyword,_typescript.default.SyntaxKind.NumberKeyword,_typescript.default.SyntaxKind.BooleanKeyword,_typescript.default.SyntaxKind.EnumDeclaration])),decoratorParamSet=(exports.simpleTypes=simpleTypes,new Set),stateObjectCollection=(exports.decoratorParamSet=decoratorParamSet,new Set);exports.stateObjectCollection=stateObjectCollection;class UpdateResult{constructor(){_defineProperty(this,"itemUpdate",!1),_defineProperty(this,"ctorUpdate",!1),_defineProperty(this,"properity",void 0),_defineProperty(this,"ctor",void 0),_defineProperty(this,"variableGet",void 0),_defineProperty(this,"variableSet",void 0),_defineProperty(this,"updateParams",void 0),_defineProperty(this,"deleteParams",!1),_defineProperty(this,"controllerSet",void 0),_defineProperty(this,"purgeVariableDepStatement",void 0),_defineProperty(this,"decoratorName",void 0),_defineProperty(this,"stateVarsParams",void 0)}setProperity(e){this.itemUpdate=!0,this.properity=e}setCtor(e){this.ctorUpdate=!0,this.ctor=e}setControllerSet(e){this.controllerSet=e}getControllerSet(){return this.controllerSet}setVariableGet(e){this.variableGet=e}setVariableSet(e){this.variableSet=e}setUpdateParams(e){this.updateParams=e}setStateVarsParams(e){this.stateVarsParams=e}setDeleteParams(e){this.deleteParams=e}setPurgeVariableDepStatement(e){this.purgeVariableDepStatement=e}setDecoratorName(e){this.decoratorName=e}isItemUpdate(){return this.itemUpdate}isCtorUpdate(){return this.ctorUpdate}getProperity(){return this.properity}getCtor(){return this.ctor}getUpdateParams(){return this.updateParams}getStateVarsParams(){return this.stateVarsParams}getPurgeVariableDepStatement(){return this.purgeVariableDepStatement}getVariableGet(){return this.variableGet}getVariableSet(){return this.variableSet}getDecoratorName(){return this.decoratorName}isDeleteParams(){return this.deleteParams}}exports.UpdateResult=UpdateResult;const curPropMap=new Map;function processMemberVariableDecorators(e,t,r,a,i,o,s,p,c,n){var d=new UpdateResult,_=t.name;if(t.decorators&&t.decorators.length){if(!t.type)return validatePropertyNonType(_,o),d;validateCustomDecorator(t.decorators,o)?d.setUpdateParams(createUpdateParams(_,_pre_define.COMPONENT_CUSTOM_DECORATOR)):processPropertyNodeDecorator(e,t,d,r,_,a,o,s,p,c,n)}else curPropMap.set(_.escapedText.toString(),_pre_define.COMPONENT_NON_DECORATOR),d.setProperity(void 0),d.setUpdateParams(createUpdateParams(_,_pre_define.COMPONENT_NON_DECORATOR)),d.setCtor((0,_process_component_constructor.updateConstructor)(r,[],[createVariableInitStatement(t,_pre_define.COMPONENT_NON_DECORATOR,o,s,p,c,n)])),d.setControllerSet(createControllerSet(t,e,_,i)),_main.partialUpdateConfig.partialUpdateMode&&d.setDeleteParams(!0);return t.decorators&&t.decorators.length&&validatePropDecorator(t.decorators)&&d.setStateVarsParams(createStateVarsBody(_)),d}function createStateVarsBody(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier("__"+e.escapedText.toString())),_typescript.default.factory.createIdentifier(_pre_define.RESERT)),void 0,[_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_PARAMS),e)]))}function createControllerSet(e,t,r,a){if(_validate_ui_syntax.componentCollection.customDialogs.has(t.getText())&&e.type&&e.type.getText()===_pre_define.SET_CONTROLLER_CTR_TYPE)return a.hasController=!0,_typescript.default.factory.createMethodDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_METHOD),void 0,void 0,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_CTR),void 0,_typescript.default.factory.createTypeReferenceNode(_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_CTR_TYPE),void 0),void 0)],void 0,_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),r),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_CTR)))],!0))}function processPropertyNodeDecorator(t,r,a,i,o,s,p,c,n,d,_){let y=0;for(let e=0;e<r.decorators.length;e++){var f=r.decorators[e].getText().replace(/\(.*\)$/,"").trim();if(f!==_pre_define.COMPONENT_WATCH_DECORATOR&&curPropMap.set(o.escapedText.toString(),f),_component_map.BUILDIN_STYLE_NAMES.has(f.replace("@",""))&&validateDuplicateDecorator(r.decorators[e],p),f!==_pre_define.COMPONENT_WATCH_DECORATOR&&isForbiddenUseStateType(r.type))return void validateForbiddenUseStateType(o,f,r.type.typeName.getText(),p);if(t.getText()===_validate_ui_syntax.componentCollection.entryComponent&&mandatoryToInitViaParamDecorators.has(f)&&validateHasIllegalDecoratorInEntry(t,o,f,p),r.initializer&&forbiddenSpecifyDefaultValueDecorators.has(f))return void validatePropertyDefaultValue(o,f,p);if(!r.initializer&&mandatorySpecifyDefaultValueDecorators.has(f))return void validatePropertyNonDefaultValue(o,f,p);r.questionToken&&mandatoryToInitViaParamDecorators.has(f)&&validateHasIllegalQuestionToken(o,f,p),isSimpleType(r.type,c)||f===_pre_define.COMPONENT_BUILDERPARAM_DECORATOR||stateObjectCollection.add(o.escapedText.toString()),f===_pre_define.COMPONENT_WATCH_DECORATOR&&validateWatchDecorator(o,r.decorators.length,p)?processWatch(r,r.decorators[e],s,p):_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(f)&&(y+=1,processStateDecorators(r,f,a,i,p,c,n,d,_))}1<y&&validateMultiDecorators(o,p)}function processStateDecorators(e,t,r,a,i,o,s,p,c){var n=e.name,d=(r.setProperity(void 0),[]),i=createVariableInitStatement(e,t,i,o,s,p,c);i&&d.push(i),addAddProvidedVar(e,n,t,d),r.setCtor((0,_process_component_constructor.updateConstructor)(a,[],[...d],!1)),t!==_pre_define.COMPONENT_BUILDERPARAM_DECORATOR&&(r.setVariableGet(createGetAccessor(n,_pre_define.CREATE_GET_METHOD)),r.setDeleteParams(!0)),immutableDecorators.has(t)||r.setVariableSet(createSetAccessor(n,_pre_define.CREATE_SET_METHOD,e.type)),setUpdateParamsDecorators.has(t)&&r.setUpdateParams(createUpdateParams(n,t,e)),setStateVarsDecorators.has(t)&&r.setStateVarsParams(createStateVarsParams(n,t)),_main.partialUpdateConfig.partialUpdateMode&&_pre_define.BASICDECORATORS.has(t)&&(o="__"+n.escapedText.toString(),r.setDecoratorName(t),r.setPurgeVariableDepStatement(createPurgeVariableDepStatement(o)))}function createPurgeVariableDepStatement(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(e)),_typescript.default.factory.createIdentifier(_pre_define.PURGEDEPENDENCYONELMTID)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.RMELMTID)]))}function processWatch(e,t,r,a){var i,o,s;e.name&&(i=e.name.getText(),t.expression)&&_typescript.default.isCallExpression(t.expression)&&t.expression.arguments&&1===t.expression.arguments.length&&(s=_validate_ui_syntax.classMethodCollection.get(e.parent.name.getText()),o=t.expression.arguments[0],_typescript.default.isStringLiteral(o)?s.has(o.text)?r.set(i,o):a.push({type:_utils.LogType.ERROR,message:`Cannot find name ${o.getText()} in struct '${e.parent.name.getText()}'.`,pos:o.getStart()}):_typescript.default.isIdentifier(t.expression.arguments[0])?(e=createPropertyAccessExpressionWithThis(s=t.expression.arguments[0].getText()),r.set(i,e),decoratorParamSet.add(s),validateWatchParam(_utils.LogType.WARN,o.getStart(),a)):_typescript.default.isPropertyAccessExpression(t.expression.arguments[0])?(r.set(i,t.expression.arguments[0]),validateWatchParam(_utils.LogType.WARN,o.getStart(),a)):validateWatchParam(_utils.LogType.ERROR,o.getStart(),a))}function createVariableInitStatement(e,t,r,a,i,o,s){var p=e.name;let c,n;switch(e.type&&(c=e.type),t){case _pre_define.COMPONENT_NON_DECORATOR:n=updateNormalProperty(e,p,r,i);break;case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:n=(_main.partialUpdateConfig.partialUpdateMode?updateObservedPropertyPU:updateObservedProperty)(e,p,c,a);break;case _pre_define.COMPONENT_LINK_DECORATOR:wrongDecoratorInPreview(e,_pre_define.COMPONENT_LINK_DECORATOR,o,r),n=(_main.partialUpdateConfig.partialUpdateMode?updateSynchedPropertyTwoWayPU:updateSynchedPropertyTwoWay)(p,c,a);break;case _pre_define.COMPONENT_PROP_DECORATOR:wrongDecoratorInPreview(e,_pre_define.COMPONENT_PROP_DECORATOR,o,r),n=(_main.partialUpdateConfig.partialUpdateMode?updateSynchedPropertyOneWayPU:updateSynchedPropertyOneWay)(p,c,t,r,a);break;case _pre_define.COMPONENT_STORAGE_PROP_DECORATOR:case _pre_define.COMPONENT_STORAGE_LINK_DECORATOR:n=updateStoragePropAndLinkProperty(e,p,t,r);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:n=(_main.partialUpdateConfig.partialUpdateMode?updateSynchedPropertyNesedObjectPU:updateSynchedPropertyNesedObject)(p,c,t,r);break;case _pre_define.COMPONENT_CONSUME_DECORATOR:wrongDecoratorInPreview(e,_pre_define.COMPONENT_CONSUME_DECORATOR,o,r),n=updateConsumeProperty(e,p);break;case _pre_define.COMPONENT_BUILDERPARAM_DECORATOR:n=updateBuilderParamProperty(e,p,r)}var d=s.members;return d.push(_typescript.default.factory.createPropertySignature(void 0,p,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.QuestionToken),c)),s=_typescript.default.factory.updateInterfaceDeclaration(s,void 0,s.modifiers,s.name,s.typeParameters,s.heritageClauses,d),n}function wrongDecoratorInPreview(e,t,r,a){r&&_main.projectConfig.isPreview&&a.push({type:_utils.LogType.WARN,message:`The variable with ${t} in component with @Preview may `+"cause error in component preview mode",pos:e.getStart()})}function createUpdateParams(e,t,r=void 0){let a;switch(t){case _pre_define.COMPONENT_NON_DECORATOR:case _pre_define.COMPONENT_STATE_DECORATOR:case _pre_define.COMPONENT_PROVIDE_DECORATOR:case _pre_define.COMPONENT_CUSTOM_DECORATOR:a=createUpdateParamsWithIf(e);break;case _pre_define.COMPONENT_PROP_DECORATOR:_main.partialUpdateConfig.partialUpdateMode?r&&r.initializer&&(a=createUpdateParamsWithIf(e,!0,r.initializer)):a=createUpdateParamsWithoutIf(e);break;case _pre_define.COMPONENT_BUILDERPARAM_DECORATOR:a=createUpdateParamsWithIf(e);break;case _pre_define.COMPONENT_OBJECT_LINK_DECORATOR:a=createUpdateParamsWithSet(e)}return a}function createStateVarsParams(e,t){let r;return r=t===_pre_define.COMPONENT_OBJECT_LINK_DECORATOR?createUpdateParamsWithSet(e):r}function createUpdateParamsWithIf(e,t=!1,r=void 0){return _typescript.default.factory.createIfStatement(_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_PARAMS),_typescript.default.factory.createIdentifier(e.escapedText.toString())),t?_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsEqualsEqualsToken):_typescript.default.factory.createToken(_typescript.default.SyntaxKind.ExclamationEqualsEqualsToken),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)),t?_typescript.default.factory.createBlock([createUpdateParamsWithSet(e,!0,r)]):_typescript.default.factory.createBlock([createUpdateParamsWithoutIf(e)],!0),void 0)}function createUpdateParamsWithoutIf(e){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis(e.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),createPropertyAccessExpressionWithParams(e.getText())))}function createUpdateParamsWithSet(e,t=!1,r=void 0){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createPropertyAccessExpressionWithThis("__"+e.getText()),_typescript.default.factory.createIdentifier(_pre_define.CREATE_SET_METHOD)),void 0,[t?r:createPropertyAccessExpressionWithParams(e.getText())]))}function updateNormalProperty(e,t,r,a){e=_typescript.default.visitNode(e.initializer,function e(t){(0,_process_component_class.isProperty)(t)&&(t=(0,_process_component_class.createReference)(t,r));return _typescript.default.visitEachChild(t,e,a)});return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis(t.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),e||_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)))}function updateObservedProperty(e,t,r,a){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+t.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(isSimpleType(r,a)?_pre_define.OBSERVED_PROPERTY_SIMPLE:_pre_define.OBSERVED_PROPERTY_OBJECT),void 0,[e.initializer,_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(t.escapedText.toString())])))}function updateSynchedPropertyTwoWay(e,t,r){e=e.escapedText.toString();return createInitExpressionStatementForDecorator(e,isSimpleType(t,r)?_pre_define.SYNCHED_PROPERTY_SIMPLE_TWO_WAY:_pre_define.SYNCHED_PROPERTY_OBJECT_TWO_WAY,createPropertyAccessExpressionWithParams(e))}function updateSynchedPropertyOneWay(e,t,r,a,i){var o=e.escapedText.toString();if(isSimpleType(t,i))return createInitExpressionStatementForDecorator(o,_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY,createPropertyAccessExpressionWithParams(o));validateNonSimpleType(e,r,a)}function updateStoragePropAndLinkProperty(r,a,i,e){if(isSingleKey(r)){let e,t;var o=[r.decorators[0].expression.arguments[0],r.initializer,_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(a.getText())];return _main.partialUpdateConfig.partialUpdateMode?(e=i===_pre_define.COMPONENT_STORAGE_PROP_DECORATOR?_pre_define.CREATE_STORAGE_PROP:_pre_define.CREATE_STORAGE_LINK,t=_pre_define.THIS,o.splice(2,1)):(e=i===_pre_define.COMPONENT_STORAGE_PROP_DECORATOR?_pre_define.APP_STORAGE_SET_AND_PROP:_pre_define.APP_STORAGE_SET_AND_LINK,t=_pre_define.APP_STORAGE),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+a.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(t),_typescript.default.factory.createIdentifier(e)),void 0,o)))}validateAppStorageDecoractorsNonSingleKey(r,e)}function getDecoratorKey(e){let t;e=e.decorators[0].expression.arguments[0];return _typescript.default.isIdentifier(e)?(t=e.getText(),decoratorParamSet.add(t)):_typescript.default.isStringLiteral(e)&&(t=e.text),t}function updateSynchedPropertyNesedObject(e,t,r,a){if(isObservedClassType(t))return createInitExpressionStatementForDecorator(e.getText(),_pre_define.SYNCHED_PROPERTY_NESED_OBJECT,createPropertyAccessExpressionWithParams(e.getText()));validateNonObservedClassType(e,r,a)}function updateConsumeProperty(e,t){t=t.getText();let r;return r=isSingleKey(e)?getDecoratorKey(e):t,_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+t),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createCallExpression(createPropertyAccessExpressionWithThis(_pre_define.INITIALIZE_CONSUME_FUNCTION),void 0,[_typescript.default.factory.createStringLiteral(r),_typescript.default.factory.createStringLiteral(t)])))}function updateBuilderParamProperty(e,t,r){t=t.getText();return judgeBuilderParamAssignedByBuilder(e)&&r.push({type:_utils.LogType.ERROR,message:"BuilderParam property can only initialized by Builder function.",pos:e.getStart()}),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis(t),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),e.initializer||_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CONSTRUCTOR_UNDEFINED)))}function judgeBuilderParamAssignedByBuilder(e){return e.initializer&&!(e.initializer&&(_typescript.default.isIdentifier(e.initializer)&&_component_map.CUSTOM_BUILDER_METHOD.has(e.initializer.escapedText.toString())||_typescript.default.isPropertyAccessExpression(e.initializer)&&e.initializer.name&&_typescript.default.isIdentifier(e.initializer.name)&&_component_map.CUSTOM_BUILDER_METHOD.has(e.initializer.name.escapedText.toString())))}function createCustomComponentBuilderArrowFunction(e,t,r){return _typescript.default.factory.createArrowFunction(void 0,void 0,[],void 0,_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsGreaterThanToken),_typescript.default.factory.createBlock([_typescript.default.factory.createVariableStatement(void 0,_typescript.default.factory.createVariableDeclarationList([_typescript.default.factory.createVariableDeclaration(t,void 0,void 0,r)],_typescript.default.NodeFlags.Let)),_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(t,_typescript.default.factory.createIdentifier(_pre_define.SET_CONTROLLER_METHOD)),void 0,[_typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),e.name)])),_typescript.default.factory.createExpressionStatement(createViewCreate(t))],!0))}function createViewCreate(e){return _main.partialUpdateConfig.partialUpdateMode?(0,_process_component_build.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME_PU),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),_typescript.default.factory.createNodeArray([e])):(0,_process_component_build.createFunction)(_typescript.default.factory.createIdentifier(_pre_define.BASE_COMPONENT_NAME),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_CREATE_FUNCTION),_typescript.default.factory.createNodeArray([e]))}function createCustomComponentNewExpression(e,t,r=!1,a=!1,i=!1){return addCustomComponentId(_typescript.default.factory.createNewExpression(e.expression,e.typeArguments,e.arguments.length?e.arguments:[]),t,r,a,i)}function addCustomComponentId(r,a,i=!1,o=!1,s=!1){var p=this;for(const e of _validate_ui_syntax.componentCollection.customComponents)_utils.componentInfo.componentNames.add(e);return _utils.componentInfo.componentNames.forEach(function(e){_newArrowCheck(this,p);let t;r.arguments&&r.arguments.length&&(t=Array.from(r.arguments)),a===e?(t=t||[_typescript.default.factory.createObjectLiteralExpression([],!0)],_main.partialUpdateConfig.partialUpdateMode?(t.unshift(o?(0,_process_component_build.parentConditionalExpression)():_typescript.default.factory.createThis()),t.push(_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_IF_UNDEFINED),s?_typescript.default.factory.createPrefixUnaryExpression(_typescript.default.SyntaxKind.MinusToken,_typescript.default.factory.createNumericLiteral("1")):_typescript.default.factory.createIdentifier(_pre_define.ELMTID),_typescript.default.factory.createIdentifier(_pre_define.COMPONENT_PARAMS_LAMBDA_FUNCTION))):(++_utils.componentInfo.id,t.unshift(i?_typescript.default.factory.createBinaryExpression(_typescript.default.factory.createStringLiteral(path.basename(_process_ui_syntax.transformLog.sourceFile.fileName,_pre_define.EXTNAME_ETS)+"_"),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.PlusToken),_typescript.default.factory.createIdentifier(_pre_define._GENERATE_ID)):_typescript.default.factory.createStringLiteral(_utils.componentInfo.id.toString()),i?(0,_process_component_build.parentConditionalExpression)():_typescript.default.factory.createThis())),r=_typescript.default.factory.updateNewExpression(r,r.expression,r.typeArguments,t)):t&&(r=_typescript.default.factory.updateNewExpression(r,r.expression,r.typeArguments,t))}.bind(this)),r}function createInitExpressionStatementForDecorator(e,t,r){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+e),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(t),void 0,[r,_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(e)])))}function createPropertyAccessExpressionWithParams(e){return _typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createIdentifier(_pre_define.CREATE_CONSTRUCTOR_PARAMS),_typescript.default.factory.createIdentifier(e))}function createPropertyAccessExpressionWithThis(e){return _typescript.default.factory.createPropertyAccessExpression(_typescript.default.factory.createThis(),_typescript.default.factory.createIdentifier(e))}function addAddProvidedVar(t,r,e,a){if(e===_pre_define.COMPONENT_PROVIDE_DECORATOR){let e;isSingleKey(t)&&(e=getDecoratorKey(t),a.push(createAddProvidedVar(e,r))),e!==r.getText()&&a.push(createAddProvidedVar(r.getText(),r))}}function createAddProvidedVar(e,t){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(createPropertyAccessExpressionWithThis(_pre_define.ADD_PROVIDED_VAR),void 0,[_typescript.default.factory.createStringLiteral(e),createPropertyAccessExpressionWithThis("__"+t.getText())]))}function createGetAccessor(e,t){return _typescript.default.factory.createGetAccessorDeclaration(void 0,void 0,e,[],void 0,_typescript.default.factory.createBlock([_typescript.default.factory.createReturnStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createPropertyAccessExpressionWithThis("__"+e.getText()),_typescript.default.factory.createIdentifier(t)),void 0,[]))],!0))}function createSetAccessor(e,t,r){return _typescript.default.factory.createSetAccessorDeclaration(void 0,void 0,e,[_typescript.default.factory.createParameterDeclaration(void 0,void 0,void 0,_typescript.default.factory.createIdentifier(_pre_define.CREATE_NEWVALUE_IDENTIFIER),void 0,r,void 0)],_typescript.default.factory.createBlock([_typescript.default.factory.createExpressionStatement(_typescript.default.factory.createCallExpression(_typescript.default.factory.createPropertyAccessExpression(createPropertyAccessExpressionWithThis("__"+e.getText()),_typescript.default.factory.createIdentifier(t)),void 0,[_typescript.default.factory.createIdentifier(_pre_define.CREATE_NEWVALUE_IDENTIFIER)]))],!0))}function isForbiddenUseStateType(e){return!!(_typescript.default.isTypeReferenceNode(e)&&_typescript.default.isIdentifier(e.typeName)&&_component_map.forbiddenUseStateType.has(e.typeName.getText()))}function isSimpleType(e,t,r){e=e||_typescript.default.factory.createKeywordTypeNode(_typescript.default.SyntaxKind.AnyKeyword);let a;return _main.globalProgram.program?a=_main.globalProgram.program.getTypeChecker():_main.globalProgram.watchProgram?a=_main.globalProgram.watchProgram.getCurrentProgram().getProgram().getTypeChecker():t&&(a=t.getTypeChecker()),getDeclarationType(e,a,r)}function getDeclarationType(e,a,i){if(simpleTypes.has(e.kind))return!0;if(_typescript.default.isTypeReferenceNode(e)&&e.typeName&&_typescript.default.isIdentifier(e.typeName)&&_validate_ui_syntax.enumCollection.has(e.typeName.escapedText.toString()))return!0;if(a){a=a.getTypeFromTypeNode(e);if(1056&a.flags)return!0;if(a.types&&a.types.length){var o=a.types;let t=!1,r=!1;for(let e=0;e<o.length;e++)isBasicType(o[e].flags)?t=!0:r=!0;if(t&&r&&i)return validateVariableType(e,i),!1;if(!r)return!0}}return!1}function isBasicType(e){return!!(4092&e)}function isObservedClassType(e){if(judgmentTypedeclaration(e)&&_validate_ui_syntax.observedClassCollection.has(e.typeName.escapedText.toString()))return!0;if(_typescript.default.isUnionTypeNode(e)&&e.types){var t=e.types;for(let e=0;e<t.length;e++)if(judgmentTypedeclaration(t[e])&&!_validate_ui_syntax.observedClassCollection.has(t[e].typeName.escapedText.toString()))return!1;return!0}return!1}function judgmentTypedeclaration(e){return _typescript.default.isTypeReferenceNode(e)&&e.typeName&&_typescript.default.isIdentifier(e.typeName)}function validateAppStorageDecoractorsNonSingleKey(e,t){_typescript.default.isIdentifier(e.decorators[0].expression)?validateDecoratorNonSingleKey(e.decorators[0].expression,t):_typescript.default.isCallExpression(e.decorators[0].expression)&&_typescript.default.isIdentifier(e.decorators[0].expression.expression)&&validateDecoratorNonSingleKey(e.decorators[0].expression.expression,t)}function isSingleKey(e){if(_typescript.default.isCallExpression(e.decorators[0].expression)&&e.decorators[0].expression.arguments&&1===e.decorators[0].expression.arguments.length&&(_typescript.default.isIdentifier(e.decorators[0].expression.arguments[0])||_typescript.default.isStringLiteral(e.decorators[0].expression.arguments[0])))return!0}function validateMultiDecorators(e,t){t.push({type:_utils.LogType.ERROR,message:`The property '${e.escapedText.toString()}' cannot have mutilate state management decorators.`,pos:e.getStart()})}function validateDecoratorNonSingleKey(e,t){t.push({type:_utils.LogType.ERROR,message:`The decorator ${e.escapedText.toString()} should have a single key.`,pos:e.getStart()})}function validatePropertyNonDefaultValue(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The ${t} property '${e.getText()}' must be specified a default value.`,pos:e.getStart()})}function validatePropertyDefaultValue(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The ${t} property '${e.getText()}' cannot be specified a default value.`,pos:e.getStart()})}function validatePropertyNonType(e,t){t.push({type:_utils.LogType.ERROR,message:`The property '${e.getText()}' must specify a type.`,pos:e.getStart()})}function validateNonSimpleType(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The type of the ${t} property '${e.getText()}' `+"can only be string, number or boolean.",pos:e.getStart()})}function validateNonObservedClassType(e,t,r){r.push({type:_utils.LogType.ERROR,message:`The type of the ${t} property '${e.getText()}' can only be `+`objects of classes decorated with ${_pre_define.COMPONENT_OBSERVED_DECORATOR} class decorator in ets (not ts).`,pos:e.getStart()})}function validateHasIllegalQuestionToken(e,t,r){r.push({type:_utils.LogType.WARN,message:`The ${t} property '${e.getText()}' cannot be an optional parameter.`,pos:e.getStart()})}function validateHasIllegalDecoratorInEntry(e,t,r,a){a.push({type:_utils.LogType.WARN,message:`The @Entry component '${e.getText()}' cannot have the `+`${r} property '${t.getText()}'.`,pos:t.getStart()})}function validateForbiddenUseStateType(e,t,r,a){a.push({type:_utils.LogType.ERROR,message:`The ${t} property '${e.getText()}' cannot be a '${r}' object.`,pos:e.getStart()})}function validateDuplicateDecorator(e,t){t.push({type:_utils.LogType.ERROR,message:`The decorator '${e.getText()}' cannot have the same name as the built-in `+`style attribute '${e.getText().replace("@","")}'.`,pos:e.getStart()})}function validateWatchDecorator(e,t,r){return 1!==t||(r.push({type:_utils.LogType.ERROR,message:`Regular variable '${e.escapedText.toString()}' can not be decorated with @Watch.`,pos:e.getStart()}),!1)}function validateWatchParam(e,t,r){r.push({type:e,message:"The parameter should be a string.",pos:t})}function validateVariableType(e,t){t.push({type:_utils.LogType.ERROR,message:`The state variable type here is '${e.getText()}', `+`it contains both a simple type and an object type,
 `+"which are not allowed to be defined for state variable of a struct.",pos:e.getStart()})}function updateObservedPropertyPU(e,t,r,a){return _typescript.default.factory.createExpressionStatement(_typescript.default.factory.createBinaryExpression(createPropertyAccessExpressionWithThis("__"+t.getText()),_typescript.default.factory.createToken(_typescript.default.SyntaxKind.EqualsToken),_typescript.default.factory.createNewExpression(_typescript.default.factory.createIdentifier(isSimpleType(r,a)?_pre_define.OBSERVED_PROPERTY_SIMPLE_PU:_pre_define.OBSERVED_PROPERTY_OBJECT_PU),void 0,[e.initializer,_typescript.default.factory.createThis(),_typescript.default.factory.createStringLiteral(t.escapedText.toString())])))}function updateSynchedPropertyTwoWayPU(e,t,r){e=e.escapedText.toString();return createInitExpressionStatementForDecorator(e,isSimpleType(t,r)?_pre_define.SYNCHED_PROPERTY_SIMPLE_TWO_WAY_PU:_pre_define.SYNCHED_PROPERTY_OBJECT_TWO_WAY_PU,createPropertyAccessExpressionWithParams(e))}function updateSynchedPropertyOneWayPU(e,t,r,a,i){e=e.escapedText.toString();return isSimpleType(t,i,a)?createInitExpressionStatementForDecorator(e,_pre_define.SYNCHED_PROPERTY_SIMPLE_ONE_WAY_PU,createPropertyAccessExpressionWithParams(e)):createInitExpressionStatementForDecorator(e,_pre_define.SYNCHED_PROPERTY_OBJECT_ONE_WAY_PU,createPropertyAccessExpressionWithParams(e))}function updateSynchedPropertyNesedObjectPU(e,t,r,a){if(isObservedClassType(t))return createInitExpressionStatementForDecorator(e.getText(),_pre_define.SYNCHED_PROPERTY_NESED_OBJECT_PU,createPropertyAccessExpressionWithParams(e.getText()));validateNonObservedClassType(e,r,a)}function validateCustomDecorator(t,e){let r=!1,a=!1,i;for(let e=0;e<t.length;e++){var o=t[e],s=o.getText().replace(/\(.*\)$/,"").trim();_pre_define.INNER_COMPONENT_MEMBER_DECORATORS.has(s)?(r=!0,i=i||o):a=!0}if(a&&r)e.push({type:_utils.LogType.ERROR,message:`The inner decorator ${i.getText()} cannot be used together with custom decorator.`,pos:i.getStart()});else if(!r)return!0;return!1}function validatePropDecorator(t){for(let e=0;e<t.length;e++){var r=t[e].getText().replace(/\(.*\)$/,"").trim();if(_pre_define.COMPONENT_PROP_DECORATOR===r)return!0}return!1}exports.curPropMap=curPropMap;