"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.newSourceMaps=void 0,exports.transformForModule=transformForModule;var _path=_interopRequireDefault(require("path")),_ark_define=require("./common/ark_define"),_module_source_file=require("./module/module_source_file"),_utils=require("./utils"),_utils2=require("../../utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let newSourceMaps={};function transformForModule(r,o){if(this.share.projectConfig.compileMode===_ark_define.ESMODULE){var s=Object.assign(this.share.arkProjectConfig,this.share.projectConfig);if((0,_utils.isTsOrEtsSourceFile)(o)&&(0,_utils.shouldETSOrTSFileTransformToJS)(o,s)&&(preserveSourceMap(o,this.getCombinedSourcemap(),s),_module_source_file.ModuleSourceFile.newSourceFile(o,r)),(0,_utils.isJsSourceFile)(o)||(0,_utils.isJsonSourceFile)(o)){let e=this.getModuleInfo(o).originalCode;(0,_utils.isJsSourceFile)(o)&&(r=transformJsByBabelPlugin(e),e=r.code,preserveSourceMap(o,r.map,s)),_module_source_file.ModuleSourceFile.newSourceFile(o,e)}}}function preserveSourceMap(e,r,o){(0,_utils.isCommonJsPluginVirtualFile)(e)||(e=(0,_utils2.toUnixPath)(e.replace(o.projectRootPath+_path.default.sep,"")),r.sources=[e],r.file=_path.default.basename(e),r.sourcesContent&&delete r.sourcesContent,newSourceMaps[e]=r)}function transformJsByBabelPlugin(e){return require("@babel/core").transformSync(e,{plugins:[[require("@babel/plugin-proposal-class-properties"),{loose:!0}]],compact:!1,sourceMaps:!0})}exports.newSourceMaps=newSourceMaps;