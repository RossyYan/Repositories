"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModuleHotfixMode=void 0;var _path=_interopRequireDefault(require("path")),_module_mode=require("./module_mode"),_ark_define=require("../common/ark_define"),_utils=require("../utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}class ModuleHotfixMode extends _module_mode.ModuleMode{constructor(e){super(e),_defineProperty(this,"patch",void 0),_defineProperty(this,"inOldSymbolTablePath",void 0),_defineProperty(this,"enableMap",void 0),this.patch=!1,this.inOldSymbolTablePath="",this.enableMap=!1}generateAbc(e){this.patch=this.projectConfig.patch||!1,this.inOldSymbolTablePath=this.projectConfig.inOldSymbolTablePath||this.projectConfig.projectRootPath,this.enableMap=this.projectConfig.enableMap||!1,this.prepareForCompilation(e),this.buildModuleSourceMapInfo(),this.generateEs2AbcCmdForHotfix(),this.generateMergedAbcOfEs2Abc()}generateEs2AbcCmdForHotfix(){var e=(0,_utils.getEs2abcFileThreadNumber)();this.cmdArgs.push(`"@${this.filesInfoPath}"`),this.cmdArgs.push("--npm-module-entry-list"),this.cmdArgs.push(`"${this.npmEntriesInfoPath}"`),this.cmdArgs.push("--output"),this.cmdArgs.push(`"${this.moduleAbcPath}"`),this.cmdArgs.push("--file-threads"),this.cmdArgs.push(`"${e}"`),this.projectConfig.patch&&(e=_path.default.join(this.projectConfig.inOldSymbolTablePath,_ark_define.PATCH_SYMBOL_TABLE),this.cmdArgs.push("--input-symbol-table"),this.cmdArgs.push(`"${e}"`),this.cmdArgs.push("--generate-patch")),this.projectConfig.enableMap&&(e=_path.default.join(this.projectConfig.inOldSymbolTablePath,_ark_define.PATCH_SYMBOL_TABLE),this.cmdArgs.push("--dump-symbol-table"),this.cmdArgs.push(`"${e}"`)),this.cmdArgs.push("--merge-abc")}}exports.ModuleHotfixMode=ModuleHotfixMode;